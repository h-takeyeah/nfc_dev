# 某室の入退室管理システム
2020年8月23日(日)時点での情報です

## できること
- 学生証をタッチした時間を学籍番号と名前と一緒にcsvに書き出す
- メンバー以外の学生証がタッチされても一応記録に残す(学籍番号は記録できますが、名前は'Unknown'になります) 8/23
- 入室と退室を区別する 8/24

## あったらいいな
- ユーザー管理(って何するのか自分もよく分かってない)
- web経由での在室人数等の確認
- もろもろの自動集計
- 入室したメンバーへの通知(室を利用した理由を書くのは手動でやってもらわないとなので)
- 短時間に何回もタッチするなどのいたずら対策
- SharePointへの自動アップロード(定時に自動でローカルと同期させるか、SharePoint上のファイルを直接更新するか)

## 事前準備
使用しているのはSonyのカードリーダー `PaSoRi SC-360/P`です。実験機のラズパイはUSBポートが1つしかないのでハブを噛ませていますが、ラズパイのUSBポートに余裕があれば直接接続する方がいいと思います。Python3を前提にしています。バージョン依存のコードはなるべく入れないように気をつけましたが、もしあったらごめんなさい。バージョンが古いとpathlibモジュールが動かないかもしれないです。
```
Linux version 4.19.118+
ARMv6-compatible processor rev 7 (v6l)
BCM2835
Raspberry Pi Model A Rev 2
Raspbian GNU/Linux 10 (buster)
Python 3.7.3
```
で動作を確認しています。
nfcpyモジュールが必要です。importエラーが出ないように先にインストールします。
```
$ pip3 install -U nfcpy
```
とりあえず現時点ではラズパイ本体にメンバーの情報を書き込んだcsvを置いておき、それを辞書にして学籍番号と名前を紐づける形をとっています。ですが個人情報なのでGitHubには置いてありません。まず某室の共有フォルダからメンバー全員の情報を引っ張ってきて、エンコードをUTF-8に直し、ファイル名をmemberlist\_utf8.csvとして保存してください。そのあと、nfc\_devディレクトリ以下に、memberlistディレクトリを作成し、そこに先ほどのファイルをコピーしてください。最終的に以下のような構成になっていればOKです。
```
nfc_dev
|-- README.md // このファイル
|-- experimental // テストに使ったソースコードたち。いらない
|   |-- ContactCheck.py
|   :
|
|-- memberlist
|   `-- memberlist_utf8.csv // これがないとだめ
`-- src
    `-- gate.py // 本体
```

## 使い方
```
$ cd nfc_dev/mysrc/
$ ./gate.py
```

## 覚え書き
- 止めるときはCTRL+C長押しです。
- 一度実行するとlogというディレクトリが作製されて、そこに記録されていきます。
- memberlist\_utf8.csvは1行目に__#学籍番号,氏名__が記録されているとして飛ばす仕様です。なので1行目にメンバーの情報を書いても読まれませんのでご注意ください。
